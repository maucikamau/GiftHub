# PlayForward - DigitalOcean App Platform deployment for SANDBOX environment

name: playforward-sandbox
region: fra
envs:
  - key: DJANGO_DEBUG
    value: "true"
    type: GENERAL
    scope: RUN_TIME

services:
  - name: web
    github:
      repo: dgavranic/progitest     # replace with your repo
      branch: sandbox
    dockerfile_path: './Dockerfile'         # relative path to Dockerfile in repo (used to build this component). See note.
    environment_slug: python
    instance_count: 1
    instance_size_slug: apps-s-1vcpu-0.5gb
    http_port: 8000
    run_command: '/start/entrypoint.sh'
    envs:
      # superuser env
      - key: DJANGO_SUPERUSER_USERNAME
        value: admin
        type: GENERAL
        scope: RUN_TIME
      - key: DJANGO_SUPERUSER_EMAIL
        value: ${DJANGO_SUPERUSER_EMAIL}
        type: SECRET
        scope: RUN_TIME
      - key: DJANGO_SUPERUSER_PASSWORD
        value: ${DJANGO_SUPERUSER_PASSWORD}
        type: SECRET
        scope: RUN_TIME
      - key: DJANGO_SETTINGS_MODULE
        value: "config.settings.production"
        type: GENERAL
        scope: RUN_TIME
      - key: DJANGO_SECRET_KEY
        value: ${DJANGO_SECRET_KEY}
        type: SECRET
        scope: RUN_TIME
      - key: DATABASE_URL
        value: ${POSTGRES_DB_URL}
        type: GENERAL
        scope: RUN_TIME
      - key: ALLOWED_HOSTS
        value: ".ondigitalocean.app"
        type: GENERAL
        scope: RUN_TIME
      - key: STATIC_ROOT
        value: "/staticfiles"
        type: GENERAL
        scope: RUN_TIME
    health_check:
      protocol: HTTP
      path: /
      port: 8000
      initial_delay_seconds: 10
      check_interval_seconds: 10
      timeout_seconds: 5
      healthy_threshold: 2
      unhealthy_threshold: 3
    resources:
      cpu: 500m
      memory: 500Mi
    routes:
      # Main app route
      - path: /

      # Static assets route â€” served directly by App Platform (no Gunicorn)
      - path: /static/*
        preserve_path_prefix: true
        static_files:
          destination: /app/staticfiles
          index_document: index.html
          error_document: index.html
